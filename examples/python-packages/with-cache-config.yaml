apiVersion: kaspr.io/v1alpha1
kind: KasprApp
metadata:
  name: app-with-advanced-packages
  namespace: default
spec:
  replicas: 3
  bootstrapServers: "kafka:9092"
  
  authentication:
    type: plain
    username: demo-user
    passwordSecret:
      secretName: kafka-credentials
      passwordKey: password
  
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  storage:
    type: persistent-claim
    class: standard
    size: 2Gi
    deleteClaim: true
  
  # Advanced Python package management configuration
  pythonPackages:
    # List of packages to install
    packages:
      - requests==2.31.0
      - pandas>=2.0.0,<3.0.0
      - numpy==1.24.0
      - scikit-learn==1.3.0
      - redis[hiredis]
      - psycopg2-binary
    
    # Custom package index configuration (optional)
    # Uncomment to use private/custom PyPI index
    # indexUrl: "https://pypi.org/simple"
    # extraIndexUrls:
    #   - "https://private-pypi.example.com/simple"
    # trustedHosts:
    #   - "private-pypi.example.com"
    
    # Package cache configuration
    # By default, cache is disabled and uses ephemeral storage (emptyDir)
    # Enable cache for persistent shared storage across pods (requires RWX storage class)
    cache:
      enabled: true                    # Enable persistent shared cache (requires ReadWriteMany storage)
      size: "1Gi"                      # Storage size for package cache
      storageClass: "fast-ssd"         # Optional: Use storage class with RWX support (EFS, Azure Files, NFS, etc.)
      accessMode: ReadWriteMany        # Default: ReadWriteMany (only supported mode)
      deleteClaim: true                # Delete PVC when app is deleted
    
    # Installation policy
    installPolicy:
      retries: 3                       # Retry failed installations 3 times
      timeout: 600                     # 10 minute timeout per package
      onFailure: block                 # Block pod startup on failure (or "warn")
    
    # Init container resource limits
    resources:
      requests:
        cpu: "200m"
        memory: "512Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
